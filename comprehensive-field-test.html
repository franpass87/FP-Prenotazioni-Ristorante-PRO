<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Test Completo di Tutti i Campi</title>
    
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: #f5f7fa; 
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status-banner {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }
        .status-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .status-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .status-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .test-results {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        .test-result {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
        }
        .test-result:last-child {
            border-bottom: none;
        }
        .test-pass { color: #28a745; }
        .test-fail { color: #dc3545; }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            opacity: 0.9;
        }
        .form-link {
            display: block;
            margin: 10px 0;
            padding: 15px;
            background: #e7f3ff;
            border: 1px solid #0066cc;
            border-radius: 6px;
            color: #0066cc;
            text-decoration: none;
            font-weight: 600;
        }
        .form-link:hover {
            background: #cce7ff;
        }
        .field-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .field-test {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
        }
        .field-test h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        .field-status {
            font-weight: bold;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Test Completo di Tutti i Campi</h1>
        
        <div id="test-status" class="status-banner status-warning">
            ‚è≥ Inizializzazione test in corso...
        </div>
        
        <div class="test-section">
            <h2>üìã Test Form Disponibili</h2>
            <p>Clicca sui link per testare le diverse versioni del form:</p>
            
            <a href="form-validation-complete.html" class="form-link" target="_blank">
                ‚úÖ Form Validation Complete - Versione Standalone
            </a>
            
            <a href="test-form-functionality-complete.html" class="form-link" target="_blank">
                üß™ Test Form Functionality - Con Dipendenze CDN
            </a>
            
            <a href="test-functionality-comprehensive.html" class="form-link" target="_blank">
                üî¨ Test Functionality Comprehensive - Completo
            </a>
        </div>
        
        <div class="test-section">
            <h2>üîß Test Automatici</h2>
            <button class="test-button" onclick="runAllFieldTests()">Esegui Test Completi</button>
            <button class="test-button" onclick="runQuickValidation()">Validazione Rapida</button>
            <button class="test-button" onclick="runAccessibilityTest()">Test Accessibilit√†</button>
            
            <div id="test-results" class="test-results" style="display: none;">
                <h3>üìä Risultati Test</h3>
                <div id="test-output"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üìù Test Campi Individuali</h2>
            <div class="field-grid" id="field-grid">
                <!-- Populated by JavaScript -->
            </div>
        </div>
        
        <div class="test-section">
            <h2>üìà Riepilogo Stato</h2>
            <div id="summary-stats"></div>
        </div>
    </div>

    <script>
        // Test results storage
        let testResults = [];
        let fieldTests = {};
        
        // Field definitions for testing
        const fieldsToTest = [
            {
                name: 'Selezione Pasto',
                type: 'radio',
                selector: 'input[name="rbf_meal"]',
                required: true,
                testValues: ['pranzo', 'brunch', 'aperitivo_cena']
            },
            {
                name: 'Data Prenotazione',
                type: 'date',
                selector: '#rbf-date',
                required: true,
                testValues: ['2025-01-15', '2025-06-30']
            },
            {
                name: 'Orario',
                type: 'select',
                selector: '#rbf-time',
                required: true,
                testValues: ['12:00', '19:30']
            },
            {
                name: 'Numero Persone',
                type: 'number',
                selector: '#rbf-people',
                required: true,
                testValues: ['2', '8', '1', '20']
            },
            {
                name: 'Nome',
                type: 'text',
                selector: '#rbf-nome, #rbf-name',
                required: true,
                testValues: ['Mario', 'Giuseppe', 'A']
            },
            {
                name: 'Cognome',
                type: 'text',
                selector: '#rbf-cognome, #rbf-surname',
                required: true,
                testValues: ['Rossi', 'Verdi']
            },
            {
                name: 'Email',
                type: 'email',
                selector: '#rbf-email',
                required: true,
                testValues: ['test@example.com', 'invalid-email', 'mario@gmail.com']
            },
            {
                name: 'Telefono',
                type: 'tel',
                selector: '#rbf-tel',
                required: true,
                testValues: ['+39 123 456 7890', '123456789', 'invalid']
            },
            {
                name: 'Privacy Policy',
                type: 'checkbox',
                selector: '#rbf-privacy',
                required: true,
                testValues: [true, false]
            }
        ];
        
        function updateTestStatus(message, type = 'warning') {
            const statusElement = document.getElementById('test-status');
            statusElement.className = `status-banner status-${type}`;
            statusElement.innerHTML = message;
        }
        
        function addTestResult(test, passed, message = '') {
            testResults.push({
                test: test,
                passed: passed,
                message: message
            });
        }
        
        function displayTestResults() {
            const resultsContainer = document.getElementById('test-results');
            const outputContainer = document.getElementById('test-output');
            
            let passedTests = testResults.filter(r => r.passed).length;
            let totalTests = testResults.length;
            let successRate = totalTests > 0 ? Math.round((passedTests / totalTests) * 100) : 0;
            
            let output = `<div class="test-result"><strong>Risultati: ${passedTests}/${totalTests} test passati (${successRate}%)</strong></div>`;
            
            testResults.forEach(result => {
                const statusClass = result.passed ? 'test-pass' : 'test-fail';
                const statusIcon = result.passed ? '‚úÖ' : '‚ùå';
                output += `<div class="test-result">
                    <span class="${statusClass}">${statusIcon} ${result.test}</span>
                    <span class="${statusClass}">${result.message}</span>
                </div>`;
            });
            
            outputContainer.innerHTML = output;
            resultsContainer.style.display = 'block';
            
            // Update main status
            if (successRate >= 80) {
                updateTestStatus(`‚úÖ Test completati con successo (${successRate}% di successo)`, 'success');
            } else if (successRate >= 50) {
                updateTestStatus(`‚ö†Ô∏è Test completati con problemi minori (${successRate}% di successo)`, 'warning');
            } else {
                updateTestStatus(`‚ùå Test completati con problemi critici (${successRate}% di successo)`, 'error');
            }
        }
        
        function testField(fieldDef) {
            const elements = document.querySelectorAll(fieldDef.selector);
            
            if (elements.length === 0) {
                fieldTests[fieldDef.name] = {
                    status: 'not-found',
                    message: 'Campo non trovato'
                };
                addTestResult(fieldDef.name, false, 'Campo non trovato nel DOM');
                return false;
            }
            
            const element = elements[0];
            let passed = true;
            let messages = [];
            
            // Test accessibility
            if (fieldDef.required) {
                const hasRequired = element.hasAttribute('required') || element.hasAttribute('aria-required');
                if (!hasRequired) {
                    passed = false;
                    messages.push('Manca attributo required/aria-required');
                }
            }
            
            // Test label association
            const hasLabel = document.querySelector(`label[for="${element.id}"]`) !== null;
            if (!hasLabel && element.type !== 'hidden') {
                passed = false;
                messages.push('Manca label associata');
            }
            
            // Test field specific functionality
            try {
                if (fieldDef.type === 'radio') {
                    const radioButtons = document.querySelectorAll(fieldDef.selector);
                    if (radioButtons.length < 2) {
                        passed = false;
                        messages.push('Numero insufficiente di opzioni radio');
                    }
                } else if (fieldDef.type === 'select') {
                    const options = element.querySelectorAll('option');
                    if (options.length < 2) {
                        passed = false;
                        messages.push('Select senza opzioni valide');
                    }
                }
                
                // Test some values if possible
                if (fieldDef.testValues && fieldDef.testValues.length > 0) {
                    const testValue = fieldDef.testValues[0];
                    if (fieldDef.type === 'checkbox') {
                        element.checked = testValue;
                    } else if (fieldDef.type === 'radio') {
                        const radioOption = document.querySelector(`${fieldDef.selector}[value="${testValue}"]`);
                        if (radioOption) radioOption.checked = true;
                    } else {
                        element.value = testValue;
                    }
                    
                    // Trigger events
                    element.dispatchEvent(new Event('change', { bubbles: true }));
                    element.dispatchEvent(new Event('input', { bubbles: true }));
                }
            } catch (error) {
                passed = false;
                messages.push(`Errore durante test: ${error.message}`);
            }
            
            fieldTests[fieldDef.name] = {
                status: passed ? 'pass' : 'fail',
                message: messages.join(', ') || 'Test completato'
            };
            
            addTestResult(fieldDef.name, passed, messages.join(', ') || 'Funzionale');
            return passed;
        }
        
        function renderFieldTests() {
            const grid = document.getElementById('field-grid');
            grid.innerHTML = '';
            
            fieldsToTest.forEach(fieldDef => {
                const test = fieldTests[fieldDef.name] || { status: 'not-tested', message: 'Non testato' };
                
                const fieldDiv = document.createElement('div');
                fieldDiv.className = 'field-test';
                
                let statusIcon = '‚ö™';
                let statusClass = '';
                
                if (test.status === 'pass') {
                    statusIcon = '‚úÖ';
                    statusClass = 'test-pass';
                } else if (test.status === 'fail') {
                    statusIcon = '‚ùå';
                    statusClass = 'test-fail';
                } else if (test.status === 'not-found') {
                    statusIcon = '‚ùì';
                    statusClass = 'test-fail';
                }
                
                fieldDiv.innerHTML = `
                    <h4>${fieldDef.name}</h4>
                    <div><strong>Tipo:</strong> ${fieldDef.type}</div>
                    <div><strong>Selettore:</strong> <code>${fieldDef.selector}</code></div>
                    <div><strong>Obbligatorio:</strong> ${fieldDef.required ? 'S√¨' : 'No'}</div>
                    <div class="field-status ${statusClass}">
                        ${statusIcon} <strong>Stato:</strong> ${test.message}
                    </div>
                `;
                
                grid.appendChild(fieldDiv);
            });
        }
        
        function runAllFieldTests() {
            testResults = [];
            fieldTests = {};
            updateTestStatus('‚è≥ Eseguendo test di tutti i campi...', 'warning');
            
            let totalTests = 0;
            let passedTests = 0;
            
            fieldsToTest.forEach(fieldDef => {
                totalTests++;
                if (testField(fieldDef)) {
                    passedTests++;
                }
            });
            
            // Test form submission
            const submitButton = document.querySelector('#rbf-submit, [type="submit"]');
            if (submitButton) {
                addTestResult('Submit Button', true, 'Presente e accessibile');
                passedTests++;
            } else {
                addTestResult('Submit Button', false, 'Non trovato');
            }
            totalTests++;
            
            renderFieldTests();
            displayTestResults();
            updateSummaryStats();
        }
        
        function runQuickValidation() {
            testResults = [];
            updateTestStatus('‚è≥ Eseguendo validazione rapida...', 'warning');
            
            // Quick tests
            addTestResult('Form principale', document.querySelector('form') !== null, 
                document.querySelector('form') ? 'Trovato' : 'Non trovato');
            
            addTestResult('Campi input', document.querySelectorAll('input').length > 5, 
                `${document.querySelectorAll('input').length} campi trovati`);
                
            addTestResult('Labels', document.querySelectorAll('label').length > 3, 
                `${document.querySelectorAll('label').length} label trovate`);
                
            addTestResult('Required fields', document.querySelectorAll('[required]').length > 3, 
                `${document.querySelectorAll('[required]').length} campi obbligatori`);
            
            displayTestResults();
        }
        
        function runAccessibilityTest() {
            testResults = [];
            updateTestStatus('‚è≥ Eseguendo test accessibilit√†...', 'warning');
            
            // Accessibility tests
            const form = document.querySelector('form');
            addTestResult('Form ha aria-label', form && form.hasAttribute('aria-label'), 
                form ? 'Aria-label presente' : 'Form non trovato');
                
            const inputs = document.querySelectorAll('input, select, textarea');
            let labelsCount = 0;
            inputs.forEach(input => {
                if (input.type !== 'hidden' && document.querySelector(`label[for="${input.id}"]`)) {
                    labelsCount++;
                }
            });
            
            addTestResult('Campi con label', labelsCount > inputs.length * 0.8, 
                `${labelsCount}/${inputs.length} campi hanno label`);
                
            addTestResult('Elementi ARIA', document.querySelectorAll('[aria-label], [aria-labelledby]').length > 0, 
                `${document.querySelectorAll('[aria-label], [aria-labelledby]').length} elementi con ARIA`);
            
            displayTestResults();
        }
        
        function updateSummaryStats() {
            const summaryDiv = document.getElementById('summary-stats');
            const totalFields = fieldsToTest.length;
            const testedFields = Object.keys(fieldTests).length;
            const passedFields = Object.values(fieldTests).filter(t => t.status === 'pass').length;
            
            summaryDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #1976d2;">${totalFields}</div>
                        <div>Campi Totali</div>
                    </div>
                    <div style="background: #f3e5f5; padding: 15px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #7b1fa2;">${testedFields}</div>
                        <div>Campi Testati</div>
                    </div>
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #388e3c;">${passedFields}</div>
                        <div>Test Superati</div>
                    </div>
                    <div style="background: #fff3e0; padding: 15px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #f57c00;">${Math.round((passedFields/totalFields)*100)}%</div>
                        <div>Tasso Successo</div>
                    </div>
                </div>
            `;
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateTestStatus('‚úÖ Pagina inizializzata - Pronto per i test', 'success');
            renderFieldTests();
            updateSummaryStats();
            
            // Auto-run quick validation
            setTimeout(runQuickValidation, 500);
        });
    </script>
</body>
</html>