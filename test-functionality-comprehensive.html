<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test Completo Funzionalit√† - FP Prenotazioni</title>
    <link rel="stylesheet" href="assets/css/frontend.css">
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: #f5f7fa; 
        }
        .demo-container { 
            max-width: 800px; 
            margin: 0 auto; 
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status-banner {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }
        .status-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .status-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .status-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-test {
            border: 2px solid #e3e6ea;
            border-radius: 8px;
            padding: 15px;
            background: #f8f9fa;
        }
        .feature-test.success {
            border-color: #28a745;
            background: #d4edda;
        }
        .feature-test.warning {
            border-color: #ffc107;
            background: #fff3cd;
        }
        .feature-test.error {
            border-color: #dc3545;
            background: #f8d7da;
        }
        .test-button {
            background: var(--rbf-primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            opacity: 0.9;
        }
        .mock-calendar {
            border: 2px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            background: white;
            text-align: center;
            margin: 10px 0;
        }
        .mock-calendar.active {
            border-color: var(--rbf-primary);
            box-shadow: 0 0 0 3px rgba(0,123,255,0.25);
        }
        .mock-phone {
            display: flex;
            border: 2px solid #ccc;
            border-radius: 8px;
            overflow: hidden;
            margin: 10px 0;
        }
        .mock-phone.active {
            border-color: var(--rbf-primary);
            box-shadow: 0 0 0 3px rgba(0,123,255,0.25);
        }
        .mock-flag {
            background: var(--rbf-primary);
            color: white;
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .mock-phone input {
            border: none;
            padding: 12px;
            flex: 1;
            outline: none;
        }
        .console-output {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
        }
        .test-results {
            background: #f1f3f4;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .emoji-status {
            font-size: 1.2em;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1>üß™ Test Completo Funzionalit√†</h1>
        <div class="status-banner" id="mainStatus">
            ‚è≥ Inizializzazione test in corso...
        </div>

        <div class="test-section">
            <h2>üìã Riepilogo Test</h2>
            <div class="test-results" id="testSummary">
                <div>üîÑ Analisi componenti in corso...</div>
            </div>
        </div>

        <div class="feature-grid">
            <div class="feature-test" id="calendarTest">
                <h3>üìÖ Test Calendario</h3>
                <div class="mock-calendar" id="mockCalendar">
                    üìÖ Calendario Flatpickr
                    <div style="font-size: 14px; margin-top: 10px;">Clicca per testare</div>
                </div>
                <button class="test-button" onclick="testCalendar()">Testa Calendario</button>
                <div id="calendarResult"></div>
            </div>

            <div class="feature-test" id="phoneTest">
                <h3>üìû Test Campo Telefono</h3>
                <div class="mock-phone" id="mockPhone">
                    <div class="mock-flag">üáÆüáπ +39</div>
                    <input type="tel" placeholder="Numero di telefono">
                </div>
                <button class="test-button" onclick="testPhone()">Testa Telefono</button>
                <div id="phoneResult"></div>
            </div>

            <div class="feature-test" id="dependencyTest">
                <h3>üîó Test Dipendenze</h3>
                <div>
                    <div id="jqueryStatus">jQuery: <span class="emoji-status">‚è≥</span></div>
                    <div id="flatpickrStatus">Flatpickr: <span class="emoji-status">‚è≥</span></div>
                    <div id="intlStatus">intl-tel-input: <span class="emoji-status">‚è≥</span></div>
                </div>
                <button class="test-button" onclick="testDependencies()">Testa Dipendenze</button>
                <div id="dependencyResult"></div>
            </div>

            <div class="feature-test" id="integrationTest">
                <h3>üîß Test Integrazione</h3>
                <div>
                    <div>‚úÖ Responsive Design</div>
                    <div>‚úÖ Accessibilit√†</div>
                    <div>‚úÖ Validazione Form</div>
                </div>
                <button class="test-button" onclick="testIntegration()">Testa Integrazione</button>
                <div id="integrationResult"></div>
            </div>
        </div>

        <div class="test-section">
            <h2>üñ•Ô∏è Console Output</h2>
            <div class="console-output" id="consoleOutput">
                Inizializzazione test...<br>
            </div>
            <button class="test-button" onclick="clearConsole()">Pulisci Console</button>
        </div>

        <div class="test-section">
            <h2>üì± Test Funzionalit√† Complete</h2>
            <div class="rbf-form-container">
                <div class="rbf-form">
                    <h3 style="text-align: center; color: var(--rbf-primary);">
                        üçΩÔ∏è Form Prenotazione Completo
                    </h3>
                    
                    <!-- Progress indicator -->
                    <div class="rbf-progress-indicator">
                        <div class="rbf-progress-step active">1</div>
                        <div class="rbf-progress-step">2</div>
                        <div class="rbf-progress-step">3</div>
                        <div class="rbf-progress-step">4</div>
                        <div class="rbf-progress-step">5</div>
                    </div>

                    <!-- Step 1: Meal selection -->
                    <div class="rbf-step" id="step-meal">
                        <div class="rbf-field-group">
                            <label class="rbf-field-label">
                                Scegli il pasto
                                <span class="rbf-required">*</span>
                            </label>
                            <div class="rbf-radio-group" role="radiogroup" aria-labelledby="meal-label">
                                <input type="radio" name="rbf_meal" id="meal-brunch" value="brunch">
                                <label for="meal-brunch" class="rbf-radio-label">Brunch</label>
                                
                                <input type="radio" name="rbf_meal" id="meal-pranzo" value="pranzo" checked>
                                <label for="meal-pranzo" class="rbf-radio-label">Pranzo</label>
                                
                                <input type="radio" name="rbf_meal" id="meal-cena" value="cena">
                                <label for="meal-cena" class="rbf-radio-label">Aperitivo e Cena</label>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: People count -->
                    <div class="rbf-step" id="step-people">
                        <div class="rbf-field-group">
                            <label class="rbf-field-label">
                                Numero di persone
                                <span class="rbf-required">*</span>
                            </label>
                            <div class="rbf-number-input" role="group" aria-label="Numero di persone">
                                <button type="button" id="rbf-people-minus" aria-label="Riduci numero persone" disabled>-</button>
                                <input type="number" id="rbf-people" value="2" min="1" max="20" aria-label="Numero di persone">
                                <button type="button" id="rbf-people-plus" aria-label="Aumenta numero persone">+</button>
                            </div>
                            <div class="rbf-help-text">Usa i pulsanti + e - per modificare</div>
                        </div>
                    </div>

                    <!-- Step 3: Date selection -->
                    <div class="rbf-step" id="step-date">
                        <div class="rbf-field-group">
                            <label class="rbf-field-label">
                                Data
                                <span class="rbf-required">*</span>
                            </label>
                            <input type="text" id="rbf-date" placeholder="Clicca per selezionare una data" readonly>
                        </div>
                    </div>

                    <!-- Step 4: Time selection -->
                    <div class="rbf-step" id="step-time">
                        <div class="rbf-field-group">
                            <label class="rbf-field-label">
                                Orario
                                <span class="rbf-required">*</span>
                            </label>
                            <select id="rbf-time">
                                <option value="">Scegli un orario...</option>
                                <option value="11:00">11:00</option>
                                <option value="11:30">11:30</option>
                                <option value="12:00">12:00</option>
                                <option value="12:30">12:30</option>
                                <option value="13:00">13:00</option>
                            </select>
                        </div>
                    </div>

                    <!-- Step 5: Personal details -->
                    <div class="rbf-step" id="step-details">
                        <div class="rbf-form-row">
                            <div class="rbf-field-group">
                                <label class="rbf-field-label">
                                    Nome
                                    <span class="rbf-required">*</span>
                                </label>
                                <input type="text" id="rbf-nome" placeholder="Il tuo nome" required>
                            </div>
                            <div class="rbf-field-group">
                                <label class="rbf-field-label">
                                    Cognome
                                    <span class="rbf-required">*</span>
                                </label>
                                <input type="text" id="rbf-cognome" placeholder="Il tuo cognome" required>
                            </div>
                        </div>
                        
                        <div class="rbf-field-group">
                            <label class="rbf-field-label">
                                Email
                                <span class="rbf-required">*</span>
                            </label>
                            <input type="email" id="rbf-email" placeholder="la-tua-email@esempio.com" required>
                        </div>
                        
                        <div class="rbf-field-group">
                            <label class="rbf-field-label">
                                Telefono
                                <span class="rbf-required">*</span>
                            </label>
                            <input type="tel" id="rbf-tel" placeholder="Il tuo numero di telefono" required>
                        </div>
                        
                        <div class="rbf-field-group">
                            <label class="rbf-field-label">Note (opzionale)</label>
                            <textarea id="rbf-note" placeholder="Eventuali richieste speciali..."></textarea>
                        </div>
                    </div>

                    <div class="rbf-checkbox-group">
                        <input type="checkbox" id="rbf-privacy" required>
                        <label for="rbf-privacy">
                            Accetto la <a href="#" target="_blank">Privacy Policy</a>
                            <span class="rbf-required">*</span>
                        </label>
                    </div>

                    <button type="submit" id="rbf-submit" class="rbf-submit-button">
                        Conferma Prenotazione
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock data for testing
        const rbfData = {
            ajaxUrl: '#',
            nonce: 'test-nonce',
            locale: 'it',
            closedDays: [],
            closedSingles: [],
            closedRanges: [],
            exceptions: {},
            minAdvanceMinutes: 60,
            maxAdvanceMinutes: 10080,
            utilsScript: '#',
            labels: {
                loading: 'Caricamento...',
                phonePlaceholder: 'Numero di telefono',
                invalidPhone: 'Numero di telefono non valido'
            }
        };

        let testResults = {
            calendar: false,
            phone: false,
            dependencies: {},
            integration: false
        };

        function logToConsole(message, type = 'info') {
            const console = document.getElementById('consoleOutput');
            const timestamp = new Date().toLocaleTimeString();
            const emoji = type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
            console.innerHTML += `[${timestamp}] ${emoji} ${message}<br>`;
            console.scrollTop = console.scrollHeight;
        }

        function updateTestStatus(testId, status, message) {
            const testEl = document.getElementById(testId);
            const resultEl = document.getElementById(testId.replace('Test', 'Result'));
            
            testEl.className = `feature-test ${status}`;
            if (resultEl) {
                const emoji = status === 'success' ? '‚úÖ' : status === 'warning' ? '‚ö†Ô∏è' : '‚ùå';
                resultEl.innerHTML = `<div>${emoji} ${message}</div>`;
            }
            
            updateSummary();
        }

        function updateSummary() {
            const summary = document.getElementById('testSummary');
            const mainStatus = document.getElementById('mainStatus');
            
            let passed = 0;
            let total = 0;
            
            Object.values(testResults).forEach(result => {
                if (typeof result === 'boolean') {
                    total++;
                    if (result) passed++;
                } else if (typeof result === 'object') {
                    Object.values(result).forEach(subResult => {
                        total++;
                        if (subResult) passed++;
                    });
                }
            });
            
            const percentage = Math.round((passed / total) * 100);
            
            if (percentage === 100) {
                mainStatus.className = 'status-banner status-success';
                mainStatus.innerHTML = '‚úÖ Tutti i test completati con successo!';
            } else if (percentage >= 75) {
                mainStatus.className = 'status-banner status-warning';
                mainStatus.innerHTML = `‚ö†Ô∏è Alcuni test necessitano attenzione (${percentage}% successo)`;
            } else {
                mainStatus.className = 'status-banner status-error';
                mainStatus.innerHTML = `‚ùå Problemi critici rilevati (${percentage}% successo)`;
            }
            
            summary.innerHTML = `
                <div><strong>Risultati Test:</strong></div>
                <div>‚úÖ Test passati: ${passed}/${total}</div>
                <div>üìä Percentuale successo: ${percentage}%</div>
            `;
        }

        function testCalendar() {
            logToConsole('Testando funzionalit√† calendario...');
            
            const mockCalendar = document.getElementById('mockCalendar');
            mockCalendar.classList.add('active');
            
            setTimeout(() => {
                // Test basic calendar functionality
                const dateInput = document.getElementById('rbf-date');
                if (dateInput) {
                    // Check if flatpickr is loaded
                    if (typeof flatpickr !== 'undefined') {
                        testResults.calendar = true;
                        updateTestStatus('calendarTest', 'success', 'Calendario Flatpickr funzionante');
                        logToConsole('Calendario inizializzato correttamente', 'success');
                    } else {
                        // Fallback to HTML5 date input
                        dateInput.type = 'date';
                        const today = new Date();
                        const tomorrow = new Date(today);
                        tomorrow.setDate(tomorrow.getDate() + 1);
                        dateInput.min = tomorrow.toISOString().split('T')[0];
                        
                        testResults.calendar = true;
                        updateTestStatus('calendarTest', 'warning', 'Fallback HTML5 date picker attivo');
                        logToConsole('Flatpickr non disponibile, usando fallback HTML5', 'warning');
                    }
                } else {
                    testResults.calendar = false;
                    updateTestStatus('calendarTest', 'error', 'Campo data non trovato');
                    logToConsole('Campo data non trovato nel DOM', 'error');
                }
                
                mockCalendar.classList.remove('active');
            }, 1000);
        }

        function testPhone() {
            logToConsole('Testando funzionalit√† campo telefono...');
            
            const mockPhone = document.getElementById('mockPhone');
            mockPhone.classList.add('active');
            
            setTimeout(() => {
                const telInput = document.getElementById('rbf-tel');
                if (telInput) {
                    // Check if intl-tel-input is loaded
                    if (typeof intlTelInput !== 'undefined') {
                        testResults.phone = true;
                        updateTestStatus('phoneTest', 'success', 'Campo telefono internazionale funzionante');
                        logToConsole('intl-tel-input inizializzato correttamente', 'success');
                    } else {
                        // Setup fallback phone input
                        telInput.type = 'tel';
                        telInput.placeholder = '+39 000 000 0000';
                        telInput.pattern = '[+][0-9]{1,4}[0-9\\s-]{6,}';
                        
                        testResults.phone = true;
                        updateTestStatus('phoneTest', 'warning', 'Campo telefono base attivo (senza prefissi)');
                        logToConsole('intl-tel-input non disponibile, usando input base', 'warning');
                    }
                } else {
                    testResults.phone = false;
                    updateTestStatus('phoneTest', 'error', 'Campo telefono non trovato');
                    logToConsole('Campo telefono non trovato nel DOM', 'error');
                }
                
                mockPhone.classList.remove('active');
            }, 1000);
        }

        function testDependencies() {
            logToConsole('Testando dipendenze JavaScript...');
            
            // Test jQuery
            if (typeof jQuery !== 'undefined') {
                testResults.dependencies.jquery = true;
                document.getElementById('jqueryStatus').innerHTML = 'jQuery: <span class="emoji-status">‚úÖ</span>';
                logToConsole('jQuery disponibile (v' + jQuery.fn.jquery + ')', 'success');
            } else {
                testResults.dependencies.jquery = false;
                document.getElementById('jqueryStatus').innerHTML = 'jQuery: <span class="emoji-status">‚ùå</span>';
                logToConsole('jQuery non disponibile', 'error');
            }
            
            // Test Flatpickr
            if (typeof flatpickr !== 'undefined') {
                testResults.dependencies.flatpickr = true;
                document.getElementById('flatpickrStatus').innerHTML = 'Flatpickr: <span class="emoji-status">‚úÖ</span>';
                logToConsole('Flatpickr disponibile', 'success');
            } else {
                testResults.dependencies.flatpickr = false;
                document.getElementById('flatpickrStatus').innerHTML = 'Flatpickr: <span class="emoji-status">‚ùå</span>';
                logToConsole('Flatpickr non disponibile', 'warning');
            }
            
            // Test intl-tel-input
            if (typeof intlTelInput !== 'undefined') {
                testResults.dependencies.intlTelInput = true;
                document.getElementById('intlStatus').innerHTML = 'intl-tel-input: <span class="emoji-status">‚úÖ</span>';
                logToConsole('intl-tel-input disponibile', 'success');
            } else {
                testResults.dependencies.intlTelInput = false;
                document.getElementById('intlStatus').innerHTML = 'intl-tel-input: <span class="emoji-status">‚ùå</span>';
                logToConsole('intl-tel-input non disponibile', 'warning');
            }
            
            const allDepsAvailable = Object.values(testResults.dependencies).every(dep => dep);
            updateTestStatus('dependencyTest', allDepsAvailable ? 'success' : 'warning', 
                allDepsAvailable ? 'Tutte le dipendenze caricate' : 'Alcune dipendenze mancanti (funzionalit√† fallback attive)');
        }

        function testIntegration() {
            logToConsole('Testando integrazione completa...');
            
            // Test responsive design
            const isMobile = window.innerWidth <= 768;
            logToConsole(`Test responsive: ${isMobile ? 'Mobile' : 'Desktop'} view detected`);
            
            // Test form accessibility
            const requiredFields = document.querySelectorAll('[required]');
            const labelsCount = document.querySelectorAll('label').length;
            logToConsole(`Accessibility: ${requiredFields.length} campi obbligatori, ${labelsCount} labels`);
            
            // Test form validation
            const form = document.querySelector('.rbf-form');
            if (form) {
                logToConsole('Form trovato e pronto per validazione');
                testResults.integration = true;
                updateTestStatus('integrationTest', 'success', 'Integrazione completa funzionante');
            } else {
                testResults.integration = false;
                updateTestStatus('integrationTest', 'error', 'Form non trovato');
            }
        }

        function clearConsole() {
            document.getElementById('consoleOutput').innerHTML = 'Console pulita...<br>';
        }

        // Initialize tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            logToConsole('Inizializzazione pagina di test completata');
            logToConsole('Clicca sui pulsanti per eseguire i test individuali');
            
            // Auto-run dependency test
            setTimeout(() => {
                testDependencies();
            }, 500);
        });

        // Add interactivity to mock elements
        document.getElementById('mockCalendar').addEventListener('click', function() {
            testCalendar();
        });

        document.getElementById('mockPhone').addEventListener('click', function() {
            testPhone();
        });
    </script>
</body>
</html>